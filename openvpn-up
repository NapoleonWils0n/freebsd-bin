#!/bin/sh

# echo tun0 ip address to unbound_outgoing_interface
echo "outgoing-interface: $(ifconfig tun0 \
| grep inet | grep -v inet6 |  head -1 | sed 's/\:/ /' | \
awk '{print $2}')" > /etc/unbound/unbound_outgoing_interface

# uncomment include
sed -i "" '/include: "\/etc\/unbound\/unbound_outgoing_interface"/s/#//' /etc/unbound/conf.d/custom.conf

# sleep for 1 second
sleep 1

# stop unbound dns server
service local_unbound stop

# start unbound dns server
service local_unbound start

# sleep for 1 second
sleep 1
