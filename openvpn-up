#!/usr/bin/env bash

# routes
ifconfig "$dev" "$ifconfig_local" "$ifconfig_remote" fib 1
route add -net "$ifconfig_remote" -iface "$dev" -fib 1
route add default "$ifconfig_remote" -fib 1

# openvpn-up
LANIF="${OPENVPN_lanif}"
ANCHOR="${OPENVPN_anchor}"

/sbin/pfctl -a "${ANCHOR}" -F rules
/sbin/pfctl -a "${ANCHOR}" -F nat
/sbin/pfctl -a "${ANCHOR}" -f - <<EOT
pass out quick on "$dev" inet keep state
antispoof quick for "$dev"
EOT
